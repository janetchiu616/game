<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phonics Spelling Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #111827;
            --card: #1f2937;
            --accent: #fbbf24;
            --accent2: #38bdf8;
            --vowel: #ef4444;
            --cons: #3b82f6;
            --text: #f9fafb;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 12px;
        }

        .container {
            width: 100%;
            max-width: 700px;
        }

        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }

        /* Intro */
        .intro-card {
            background: var(--card);
            border-radius: 18px;
            padding: 24px 18px 28px;
            text-align: center;
            box-shadow: 0 18px 40px rgba(0,0,0,0.5);
        }

        .intro-card h1 {
            font-size: 2.1rem;
            margin-bottom: 12px;
            color: var(--accent);
        }

        .intro-card p {
            font-size: 1.05rem;
            margin-bottom: 10px;
        }

        .intro-emoji {
            font-size: 3.8rem;
            margin: 10px 0 16px;
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 14px 34px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            color: #111827;
            background: linear-gradient(135deg, #fbbf24, #f97316);
            box-shadow: 0 8px 20px rgba(251,191,36,0.35);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        .btn:active {
            transform: scale(0.96);
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        /* Game layout */
        .game-card {
            background: var(--card);
            border-radius: 18px;
            padding: 14px 12px 18px;
            box-shadow: 0 18px 40px rgba(0,0,0,0.5);
        }

        .top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .progress {
            font-weight: 600;
            color: var(--accent);
        }

        .stars-small {
            font-size: 1.2rem;
        }

        .tip-bar {
            font-size: 0.85rem;
            background: #020617;
            border-radius: 12px;
            padding: 8px 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: center;
            gap: 14px;
        }

        .tip-red {
            color: var(--vowel);
            font-weight: 600;
        }

        .tip-blue {
            color: var(--cons);
            font-weight: 600;
        }

        .emoji-row {
            text-align: center;
            margin: 8px 0 6px;
        }

        .word-emoji {
            font-size: 4.2rem;
        }

        .speak-row {
            display: flex;
            justify-content: center;
            margin-bottom: 8px;
        }

        .btn-speak {
            border-radius: 999px;
            border: none;
            padding: 8px 18px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            background: #0ea5e9;
            color: #0b1120;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .middle-area {
            margin: 8px 0 4px;
        }

        .instruction {
            text-align: center;
            font-size: 0.95rem;
            margin-bottom: 6px;
            color: #e5e7eb;
        }

        .boxes-row {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 4px;
        }

        .drop-box {
            width: 72px;
            height: 80px;
            border-radius: 10px;
            border: 3px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            color: #f9fafb;
            background: #020617;
            touch-action: none;
        }

        .drop-box.vowel {
            background: #7f1d1d;
            border-color: var(--vowel);
        }

        .drop-box.consonant {
            background: #1e3a8a;
            border-color: var(--cons);
        }

        .drop-box.highlight {
            box-shadow: 0 0 0 3px rgba(248,250,252,0.7);
        }

        .feedback {
            text-align: center;
            font-size: 0.95rem;
            min-height: 22px;
            margin: 4px 0 4px;
        }

        .feedback.ok {
            color: #22c55e;
        }
        .feedback.bad {
            color: #f97316;
        }

        .tiles-area {
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px solid #374151;
        }

        .tiles-label {
            font-size: 0.85rem;
            text-align: center;
            margin-bottom: 6px;
            color: #e5e7eb;
        }

        .tiles-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            padding: 0 2px;
        }

        .tile {
            width: 58px;
            height: 58px;
            border-radius: 12px;
            background: #111827;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 700;
            color: #f9fafb;
            cursor: grab;
            touch-action: none;
        }

        .tile.dragging {
            opacity: 0.6;
        }

        .bottom-row {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-check {
            background: #22c55e;
            color: #022c22;
            border-radius: 999px;
            border: none;
            padding: 10px 26px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-reset {
            background: #f97316;
            color: #111827;
            border-radius: 999px;
            border: none;
            padding: 10px 18px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
        }

        .btn-check:active,
        .btn-reset:active,
        .btn-speak:active {
            transform: scale(0.96);
        }

        /* Results */
        .results-card {
            background: var(--card);
            border-radius: 18px;
            padding: 24px 18px 28px;
            text-align: center;
            box-shadow: 0 18px 40px rgba(0,0,0,0.5);
        }

        .results-card h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .results-score {
            font-size: 1.3rem;
            margin-bottom: 6px;
        }

        .results-stars {
            font-size: 2.4rem;
            margin: 4px 0 14px;
        }

        .btn-play-again {
            border: none;
            border-radius: 999px;
            padding: 12px 28px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            color: #111827;
            background: linear-gradient(135deg, #a855f7, #ec4899);
        }

        @media (min-width: 640px) {
            .intro-card h1 {
                font-size: 2.4rem;
            }
            .word-emoji {
                font-size: 4.8rem;
            }
            .drop-box {
                width: 80px;
                height: 88px;
                font-size: 2.2rem;
            }
            .tile {
                width: 64px;
                height: 64px;
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <!-- Intro -->
    <div class="screen active" id="introScreen">
        <div class="intro-card">
            <h1>Phonics Spelling</h1>
            <p>Look at the picture. Listen to the word. Drag the letters to spell it.</p>
            <div class="intro-emoji">üê± üî§ üéâ</div>
            <p style="font-size:0.95rem;opacity:0.9;">Red box = vowel (A E I O U) ‚Ä¢ Blue box = consonant</p>
            <div style="margin-top:18px;">
                <button class="btn" onclick="startGame()">Start Game</button>
            </div>
        </div>
    </div>

    <!-- Game -->
    <div class="screen" id="gameScreen">
        <div class="game-card">
            <div class="top-row">
                <div class="progress" id="progressText">Question 1 / 10</div>
                <div class="stars-small" id="smallStars"></div>
            </div>

            <div class="tip-bar">
                <span class="tip-red">Red = vowel (A E I O U)</span>
                <span class="tip-blue">Blue = consonant</span>
            </div>

            <div class="emoji-row">
                <div class="word-emoji" id="wordEmoji">üê±</div>
            </div>

            <div class="speak-row">
                <button class="btn-speak" type="button" onclick="speakWord()">
                    <span>üîä</span><span>Say the word</span>
                </button>
            </div>

            <div class="middle-area">
                <div class="instruction">Drag the letters into the boxes.</div>
                <div class="boxes-row" id="boxesRow"></div>
                <div class="feedback" id="feedback"></div>
            </div>

            <div class="tiles-area">
                <div class="tiles-label">Letters to use:</div>
                <div class="tiles-row" id="tilesRow"></div>
            </div>

            <div class="bottom-row">
                <button class="btn-check" type="button" onclick="checkAnswer()">‚úÖ Check</button>
                <button class="btn-reset" type="button" onclick="resetLetters()">Reset</button>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div class="screen" id="resultsScreen">
        <div class="results-card">
            <h2>Great job!</h2>
            <div class="results-score">You spelled <span id="scoreText">0</span> / 10 words.</div>
            <div class="results-stars" id="resultsStars"></div>
            <button class="btn-play-again" type="button" onclick="playAgain()">Play again</button>
        </div>
    </div>
</div>

<script>
    const wordEmojis = {
        HOT: "üî•",
        MUM: "üë©",
        POT: "üç≤",
        JAM: "ü´ô",
        BUN: "ü•ê",
        BAG: "üëú",
        NET: "ü•Ö",
        BUG: "üêõ",
        FUN: "üéâ",
        MUD: "ü™µ",
        BUS: "üöå",
        DOG: "üêï",
        HUG: "ü§ó",
        CUP: "‚òï",
        DAD: "üë®",
        RAT: "üê≠",
        VAN: "üöê",
        RED: "üî¥",
        ZIP: "ü§ê",
        FAN: "ü™≠",
        MOP: "üßπ",
	PIG: "üê∑",
	FIT: "üí™",
        CAT: "üê±"
    };

    const allWords = Object.keys(wordEmojis);
    const vowels = ["A","E","I","O","U"];

    let gameWords = [];
    let currentIndex = 0;
    let score = 0;

    let dragData = {
        sourceType: null,   // "tile" or "box"
        sourceIndex: null,
        letter: null
    };

    function shuffle(arr){
        return arr.slice().sort(() => Math.random() - 0.5);
    }

    function startGame(){
        gameWords = shuffle(allWords).slice(0,10);
        currentIndex = 0;
        score = 0;
        updateSmallStars();
        showScreen("gameScreen");
        loadWord();
    }

    function showScreen(id){
        document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
        document.getElementById(id).classList.add("active");
    }

    function loadWord(){
        const word = gameWords[currentIndex];
        document.getElementById("progressText").textContent =
            "Question " + (currentIndex+1) + " / 10";
        document.getElementById("wordEmoji").textContent = wordEmojis[word];
        document.getElementById("feedback").textContent = "";

        const boxesRow = document.getElementById("boxesRow");
        boxesRow.innerHTML = "";
        word.split("").forEach((ch, i) => {
            const box = document.createElement("div");
            box.className = "drop-box " + (vowels.includes(ch) ? "vowel" : "consonant");
            box.dataset.index = String(i);
            box.textContent = "";
            box.addEventListener("pointerdown", boxPointerDown);
            boxesRow.appendChild(box);
        });

        const tilesRow = document.getElementById("tilesRow");
        tilesRow.innerHTML = "";
        const correctLetters = word.split("");
        const lettersPool = Array.from(new Set(allWords.join("").split("")));
        const distractors = shuffle(
            lettersPool.filter(l => !correctLetters.includes(l))
        ).slice(0,2);
        const tiles = shuffle(correctLetters.concat(distractors));

        tiles.forEach((letter, i) => {
            const tile = document.createElement("div");
            tile.className = "tile";
            tile.textContent = letter;
            tile.dataset.index = String(i);
            tile.addEventListener("pointerdown", tilePointerDown);
            tilesRow.appendChild(tile);
        });

        speakWord();
    }

    function tilePointerDown(e){
        e.preventDefault();
        const tile = e.currentTarget;
        if (!tile.textContent) return;
        dragData.sourceType = "tile";
        dragData.sourceIndex = tile.dataset.index;
        dragData.letter = tile.textContent;
        tile.classList.add("dragging");
        startPointerDrag(e);
    }

    function boxPointerDown(e){
        e.preventDefault();
        const box = e.currentTarget;
        if (!box.textContent) return;
        dragData.sourceType = "box";
        dragData.sourceIndex = box.dataset.index;
        dragData.letter = box.textContent;
        box.classList.add("dragging");
        startPointerDrag(e);
    }

    function startPointerDrag(e){
        window.addEventListener("pointermove", pointerMove);
        window.addEventListener("pointerup", pointerUp, { once:true });
    }

    function pointerMove(e){
        e.preventDefault();
        const boxes = document.querySelectorAll(".drop-box");
        boxes.forEach(b => b.classList.remove("highlight"));
        const el = document.elementFromPoint(e.clientX, e.clientY);
        if (el && el.classList && el.classList.contains("drop-box")) {
            el.classList.add("highlight");
        }
    }

    function pointerUp(e){
        const tilesRow = document.getElementById("tilesRow");
        const boxes = document.querySelectorAll(".drop-box");
        boxes.forEach(b => b.classList.remove("highlight"));
        document.querySelectorAll(".tile, .drop-box").forEach(el => el.classList.remove("dragging"));

        const target = document.elementFromPoint(e.clientX, e.clientY);
        if (!dragData.letter) {
            resetDragData();
            return;
        }

        if (target && target.classList && target.classList.contains("drop-box")) {
            const targetIndex = target.dataset.index;
            placeLetterInBox(targetIndex);
        } else if (target && (target.id === "tilesRow" || target.closest("#tilesRow"))) {
            placeLetterBackToTiles();
        }
        resetDragData();

        window.removeEventListener("pointermove", pointerMove);
    }

    function placeLetterInBox(targetIndex){
        const boxes = document.querySelectorAll(".drop-box");
        const tiles = document.querySelectorAll(".tile");

        const targetBox = Array.from(boxes).find(b => b.dataset.index === targetIndex);
        if (!targetBox) return;

        if (dragData.sourceType === "tile") {
            const tile = Array.from(tiles).find(t => t.dataset.index === dragData.sourceIndex);
            if (!tile) return;
            const existing = targetBox.textContent;
            if (existing) {
                tile.textContent = existing;
            } else {
                tile.textContent = "";
            }
            targetBox.textContent = dragData.letter;
        } else if (dragData.sourceType === "box") {
            const fromBox = Array.from(boxes).find(b => b.dataset.index === dragData.sourceIndex);
            if (!fromBox) return;
            const existing = targetBox.textContent;
            if (existing) {
                targetBox.textContent = dragData.letter;
                fromBox.textContent = existing;
            } else {
                targetBox.textContent = dragData.letter;
                fromBox.textContent = "";
            }
        }
    }

    function placeLetterBackToTiles(){
        const tilesRow = document.getElementById("tilesRow");
        const boxes = document.querySelectorAll(".drop-box");
        const tiles = document.querySelectorAll(".tile");

        if (dragData.sourceType === "tile") {
            return;
        }

        if (dragData.sourceType === "box") {
            const fromBox = Array.from(boxes).find(b => b.dataset.index === dragData.sourceIndex);
            if (!fromBox) return;
            const emptyTile = Array.from(tiles).find(t => !t.textContent);
            if (emptyTile) {
                emptyTile.textContent = dragData.letter;
            } else {
                const newTile = document.createElement("div");
                newTile.className = "tile";
                newTile.textContent = dragData.letter;
                newTile.dataset.index = String(tiles.length);
                newTile.addEventListener("pointerdown", tilePointerDown);
                tilesRow.appendChild(newTile);
            }
            fromBox.textContent = "";
        }
    }

    function resetDragData(){
        dragData.sourceType = null;
        dragData.sourceIndex = null;
        dragData.letter = null;
    }

    function checkAnswer(){
        const word = gameWords[currentIndex];
        const boxes = document.querySelectorAll(".drop-box");
        const answer = Array.from(boxes).map(b => b.textContent || "").join("");
        const feedback = document.getElementById("feedback");

        if (answer.length < word.length || Array.from(boxes).some(b => !b.textContent)) {
            feedback.textContent = "Fill all the boxes.";
            feedback.className = "feedback bad";
            playErrorSound(true);
            return;
        }

        if (answer === word) {
            feedback.textContent = "Great job! ‚úî";
            feedback.className = "feedback ok";
            score++;
            playSuccessSound();
            setTimeout(() => {
                currentIndex++;
                if (currentIndex < gameWords.length) {
                    loadWord();
                } else {
                    showResults();
                }
            }, 1500);
        } else {
            feedback.textContent = "Not quite. Try again!";
            feedback.className = "feedback bad";
            playErrorSound(false);
            resetLetters();
        }
    }

    function resetLetters(){
        const boxes = document.querySelectorAll(".drop-box");
        const tilesRow = document.getElementById("tilesRow");
        const letters = [];

        boxes.forEach(b => {
            if (b.textContent) letters.push(b.textContent);
            b.textContent = "";
        });

        document.querySelectorAll(".tile").forEach(t => {
            if (t.textContent) letters.push(t.textContent);
            t.remove();
        });

        letters.forEach((ch, i) => {
            const tile = document.createElement("div");
            tile.className = "tile";
            tile.textContent = ch;
            tile.dataset.index = String(i);
            tile.addEventListener("pointerdown", tilePointerDown);
            tilesRow.appendChild(tile);
        });
    }

    function speakWord(){
        const word = gameWords[currentIndex];
        if (!window.speechSynthesis) return;
        const u = new SpeechSynthesisUtterance(word);
        u.rate = 0.9;
        u.pitch = 1.1;
        u.volume = 1;
        const voices = speechSynthesis.getVoices();
        const preferred = voices.find(v => /child|kids/i.test(v.name)) ||
                         voices.find(v => /female/i.test(v.name) && /en/i.test(v.lang)) ||
                         voices[0];
        if (preferred) u.voice = preferred;
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
    }

    function playSuccessSound(){
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const notes = [700, 900, 1100];
        notes.forEach((f, i) => {
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.frequency.value = f;
            o.type = "triangle";
            o.connect(g);
            g.connect(ctx.destination);
            const t = ctx.currentTime + i * 0.15;
            g.gain.setValueAtTime(0.25, t);
            g.gain.exponentialRampToValueAtTime(0.01, t + 0.25);
            o.start(t);
            o.stop(t + 0.25);
        });
    }

    function playErrorSound(short){
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "square";
        o.frequency.value = 220;
        o.connect(g);
        g.connect(ctx.destination);
        const len = short ? 0.18 : 0.35;
        g.gain.setValueAtTime(0.25, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + len);
        o.start();
        o.stop(ctx.currentTime + len);
    }

    function showResults(){
        document.getElementById("scoreText").textContent = String(score);
        const stars = Math.round((score / 10) * 5);
        document.getElementById("resultsStars").textContent =
            stars ? "‚≠ê".repeat(stars) : "üí´";
        showScreen("resultsScreen");
    }

    function updateSmallStars(){
        const stars = Math.round((score / 10) * 5);
        document.getElementById("smallStars").textContent =
            stars ? "‚≠ê".repeat(stars) : "";
    }

    function playAgain(){
        startGame();
    }

    if ("speechSynthesis" in window) {
        speechSynthesis.onvoiceschanged = () => {};
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Math Adventure</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            text-align: center;
            background: linear-gradient(to bottom, #a8e6cf, #dcedc1);
            color: #333;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        h1 {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(32px, 8vw, 48px);
            color: #ff6b6b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin: 10px 0;
        }
        #level {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(28px, 7vw, 40px);
            margin: 15px;
            color: #4ecdc4;
            background-color: rgba(255,255,255,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
        }
        #question {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(24px, 6vw, 36px);
            margin: 20px 10px;
            color: #2d3436;
        }
        #visual {
            flex: 1;
            margin: 10px auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            max-width: 100%;
            min-height: 200px;
        }
        #options {
            margin: 10px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }
        #feedback {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(32px, 8vw, 48px);
            margin: 10px;
            min-height: 60px;
            font-weight: bold;
        }
        button {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(24px, 6vw, 32px);
            padding: clamp(10px, 3vw, 15px) clamp(20px, 5vw, 30px);
            margin: 10px;
            cursor: pointer;
            border-radius: 15px;
            border: 4px solid transparent;
            background: linear-gradient(45deg, #ffe66d, #ff9f1c);
            box-shadow: 0 6px 0 #cc7a00;
            transition: all 0.2s;
            min-width: 100px;
        }
        button:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #cc7a00;
        }
        button.selected-correct {
            border: 6px solid #00b894 !important;
            box-shadow: 0 0 20px #00b894, 0 6px 0 #cc7a00;
        }
        button.selected-wrong {
            border: 6px solid #e74c3c !important;
            box-shadow: 0 0 20px #e74c3c, 0 6px 0 #cc7a00;
        }
        .shape {
            width: clamp(80px, 25vw, 140px);
            height: clamp(80px, 25vw, 140px);
            margin: 15px;
            border-radius: 15px;
            border: 4px solid transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 8px 0 rgba(0,0,0,0.2);
        }
        .shape.selected-correct {
            border: 6px solid #00b894 !important;
            box-shadow: 0 0 20px #00b894, 0 8px 0 rgba(0,0,0,0.2);
        }
        .shape.selected-wrong {
            border: 6px solid #e74c3c !important;
            box-shadow: 0 0 20px #e74c3c, 0 8px 0 rgba(0,0,0,0.2);
        }
        .comparison {
            transition: all 0.2s;
            cursor: pointer;
            font-size: clamp(140px, 35vw, 240px);
            user-select: none;
            padding: 20px;
            border-radius: 20px;
            border: 4px solid transparent;
        }
        .comparison.selected-correct {
            border: 8px solid #00b894 !important;
            box-shadow: 0 0 30px #00b894;
        }
        .comparison.selected-wrong {
            border: 8px solid #e74c3c !important;
            box-shadow: 0 0 30px #e74c3c;
        }
        .position-box {
            width: clamp(150px, 50vw, 250px);
            height: clamp(80px, 20vw, 120px);
            background: linear-gradient(#74b9ff, #0984e3);
            margin: 15px auto;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 0 #0559a0;
        }
        .ball {
            font-size: clamp(60px, 15vw, 90px);
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .comparison-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            flex-wrap: wrap;
            width: 100%;
        }
        @media (max-width: 600px) {
            .comparison {
                font-size: clamp(100px, 25vw, 180px);
            }
            .comparison-container {
                gap: 30px;
            }
        }
        .missing {
            color: #e74c3c;
            font-weight: bold;
            font-size: clamp(40px, 10vw, 60px);
        }
        .sequence {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(36px, 9vw, 56px);
            font-weight: bold;
            padding: 20px;
            background-color: rgba(255,255,255,0.8);
            border-radius: 20px;
            display: inline-block;
            margin: 10px;
        }
        #next-btn, #replay-btn {
            display: none;
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(24px, 6vw, 32px);
            padding: clamp(15px, 4vw, 20px) clamp(30px, 8vw, 50px);
            margin: 20px auto;
        }
        #next-btn {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            box-shadow: 0 8px 0 #5f3dc4;
        }
        #next-btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #5f3dc4;
        }
        #replay-btn {
            background: linear-gradient(45deg, #ff9f1c, #ffe66d);
            box-shadow: 0 8px 0 #cc7a00;
        }
        #replay-btn:active {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #cc7a00;
        }
        #name-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        #name-input {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(28px, 7vw, 40px);
            padding: 15px;
            width: 80%;
            max-width: 400px;
            text-align: center;
            border-radius: 15px;
            border: none;
            margin-bottom: 30px;
        }
        #start-btn {
            font-family: Arial, Helvetica, sans-serif;
            font-size: clamp(28px, 7vw, 40px);
        }
    </style>
</head>
<body>
    <!-- Name input screen -->
    <div id="name-screen">
        <h1 style="color: white; margin-bottom: 40px;">Fun Math Adventure</h1>
        <div style="color: white; font-size: clamp(28px, 7vw, 40px); margin-bottom: 20px;">
            What is your name?
        </div>
        <input type="text" id="name-input" placeholder="Type your name here" autofocus>
        <button id="start-btn">Start Game</button>
    </div>

    <!-- Main game -->
    <h1>Fun Math Adventure</h1>
    <div id="level">Level 1</div>
    <div id="question"></div>
    <div id="visual"></div>
    <div id="options"></div>
    <div id="feedback"></div>
    <button id="next-btn">Next Question</button>
    <button id="replay-btn">Play Again</button>

    <script>
        let playerName = "";
        let currentLevel = 1;
        let correctAnswers = 0;
        const questionsPerLevel = 3;
        const levels = 4;

        let usedLevel1Questions = new Set();
        let usedLevel2Questions = new Set();
        let usedLevel3Animals = new Set();
        let usedLevel4Sequences = new Set();

        const positions = ['Top', 'Middle', 'Bottom'];
        const shapes = ['Circle', 'Triangle', 'Square', 'Rectangle'];
        const shapeColors = ['#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1', '#ff9ff3', '#54a0ff'];

        const comparisons = [
            { name: 'thin-fat', pair: ['Thin', 'Fat'] },
            { name: 'tall-short', pair: ['Tall', 'Short'] },
            { name: 'curve-straight', pair: ['Curve', 'Straight'] },
            { name: 'thick-thin-line', pair: ['Thick line', 'Thin line'] }
        ];

        const animalNames = {
            'ü¶Å': 'lions',
            'üêØ': 'tigers',
            'üêò': 'elephants',
            'ü¶í': 'giraffes',
            'üêµ': 'monkeys',
            'ü¶ä': 'foxes',
            'üêª': 'bears',
            'üêº': 'pandas',
            'ü¶ù': 'raccoons',
            'üê®': 'koalas',
            'ü¶ú': 'parrots',
            'ü¶ã': 'butterflies',
            'üê¨': 'dolphins',
            'ü¶î': 'hedgehogs',
            'üêô': 'octopuses'
        };

        const animals = Object.keys(animalNames);

        // Start game with name input
        document.getElementById('start-btn').onclick = () => {
            playerName = document.getElementById('name-input').value.trim();
            if (playerName === "") playerName = "Little Champion";
            document.getElementById('name-screen').style.display = 'none';
            generateQuestion();
        };

        document.getElementById('name-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('start-btn').click();
            }
        });

        // Replay button function
        document.getElementById('replay-btn').onclick = () => {
            currentLevel = 1;
            correctAnswers = 0;
            usedLevel1Questions.clear();
            usedLevel2Questions.clear();
            usedLevel3Animals.clear();
            usedLevel4Sequences.clear();
            document.getElementById('level').innerHTML = 'Level 1';
            document.getElementById('replay-btn').style.display = 'none';
            generateQuestion();
        };

        function clearHighlights() {
            document.querySelectorAll('button, .shape, .comparison').forEach(el => {
                el.classList.remove('selected-correct', 'selected-wrong');
            });
        }

        function checkAnswer(element, isCorrect) {
            clearHighlights();
            if (isCorrect) {
                element.classList.add('selected-correct');
                document.getElementById('feedback').innerHTML = 'Great job!';
                document.getElementById('feedback').style.color = '#00b894';
                correctAnswers++;

                const nextBtn = document.getElementById('next-btn');
                nextBtn.innerHTML = 'Next Question';
                nextBtn.style.display = 'block';
                nextBtn.onclick = () => {
                    nextBtn.style.display = 'none';
                    if (correctAnswers >= questionsPerLevel) {
                        currentLevel++;
                        correctAnswers = 0;
                        usedLevel1Questions.clear();
                        usedLevel2Questions.clear();
                        usedLevel3Animals.clear();
                        usedLevel4Sequences.clear();

                        if (currentLevel > levels) {
                            document.getElementById('question').innerHTML = '';
                            document.getElementById('visual').innerHTML = `
                                <h2 style="font-size: clamp(40px, 10vw, 60px); margin: 20px;">
                                    Congratulations, ${playerName}!<br>
                                    You completed all levels!<br>
                                    You did really well!
                                </h2>`;
                            document.getElementById('options').innerHTML = '';
                            document.getElementById('feedback').innerHTML = '';
                            document.getElementById('level').innerHTML = 'Amazing Job!';
                            nextBtn.style.display = 'none';
                            document.getElementById('replay-btn').style.display = 'block';
                            return;
                        }
                        document.getElementById('level').innerHTML = 'Level ' + currentLevel;
                    }
                    generateQuestion();
                };
            } else {
                element.classList.add('selected-wrong');
                document.getElementById('feedback').innerHTML = 'Try again!';
                document.getElementById('feedback').style.color = '#e74c3c';
                document.getElementById('next-btn').style.display = 'none';
            }
        }

        function generateQuestion() {
            clearHighlights();
            const questionDiv = document.getElementById('question');
            const visualDiv = document.getElementById('visual');
            const optionsDiv = document.getElementById('options');
            const feedbackDiv = document.getElementById('feedback');

            feedbackDiv.innerHTML = '';
            visualDiv.innerHTML = '';
            optionsDiv.innerHTML = '';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('replay-btn').style.display = 'none';

            document.getElementById('level').innerHTML = 'Level ' + currentLevel;

            switch (currentLevel) {
                case 1: generateLevel1Question(); break;
                case 2: generateLevel2Question(); break;
                case 3: generateLevel3Question(); break;
                case 4: generateLevel4Question(); break;
            }

            // Auto-scroll to top of game area after new question loads
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // All generateLevel functions remain the same (unchanged from previous version)

        function generateLevel1Question() {
            const type = usedLevel1Questions.size < 2 ? (usedLevel1Questions.has('position') ? 'shape' : 'position') : (Math.random() < 0.5 ? 'position' : 'shape');

            if (type === 'position') {
                let correctPos;
                do {
                    correctPos = positions[Math.floor(Math.random() * positions.length)];
                } while (usedLevel1Questions.has(`pos-${correctPos}`));
                usedLevel1Questions.add(`pos-${correctPos}`);

                document.getElementById('question').innerHTML = 'Where is the bouncing ball?';

                const container = document.createElement('div');
                container.style.display = 'flex';
                container.style.flexDirection = 'column';
                container.style.alignItems = 'center';
                container.style.width = '100%';

                const topBox = document.createElement('div'); topBox.className = 'position-box';
                const middleBox = document.createElement('div'); middleBox.className = 'position-box';
                const bottomBox = document.createElement('div'); bottomBox.className = 'position-box';

                const ball = document.createElement('div');
                ball.className = 'ball';
                ball.innerHTML = '‚öΩ';

                if (correctPos === 'Top') topBox.appendChild(ball);
                else if (correctPos === 'Middle') middleBox.appendChild(ball);
                else bottomBox.appendChild(ball);

                container.appendChild(topBox);
                container.appendChild(middleBox);
                container.appendChild(bottomBox);
                document.getElementById('visual').appendChild(container);

                positions.forEach(pos => {
                    const btn = document.createElement('button');
                    btn.innerHTML = pos;
                    btn.onclick = function() { checkAnswer(this, pos === correctPos); };
                    document.getElementById('options').appendChild(btn);
                });
            } else {
                let correctShape;
                do {
                    correctShape = shapes[Math.floor(Math.random() * shapes.length)];
                } while (usedLevel1Questions.has(`shape-${correctShape}`));
                usedLevel1Questions.add(`shape-${correctShape}`);

                document.getElementById('question').innerHTML = `Which one is the ${correctShape.toLowerCase()}?`;

                const shuffled = [...shapes].sort(() => Math.random() - 0.5);
                shuffled.forEach(shape => {
                    const div = createShapeDiv(shape);
                    div.onclick = function() { checkAnswer(this, shape === correctShape); };
                    document.getElementById('options').appendChild(div);
                });
            }
        }

        // The other generateLevel functions (2,3,4), createShapeDiv, createEmojiComparison are identical to the previous version

        function generateLevel2Question() {
            let comp;
            do {
                comp = comparisons[Math.floor(Math.random() * comparisons.length)];
            } while (usedLevel2Questions.has(comp.name));
            usedLevel2Questions.add(comp.name);

            const which = Math.floor(Math.random() * 2);
            const correct = comp.pair[which];

            const correctText = correct.toLowerCase().replace(' line', '');

            document.getElementById('question').innerHTML = `Which one is ${correctText}?`;

            const visualDiv = document.getElementById('visual');
            const container = document.createElement('div');
            container.className = 'comparison-container';

            const order = [0, 1].sort(() => Math.random() - 0.5);
            const leftType = comp.pair[order[0]];
            const rightType = comp.pair[order[1]];

            const left = createEmojiComparison(leftType);
            const right = createEmojiComparison(rightType);

            left.onclick = function() { checkAnswer(this, leftType === correct); };
            right.onclick = function() { checkAnswer(this, rightType === correct); };

            container.appendChild(left);
            container.appendChild(right);
            visualDiv.appendChild(container);
        }

        function generateLevel3Question() {
            let animal;
            do {
                animal = animals[Math.floor(Math.random() * animals.length)];
            } while (usedLevel3Animals.has(animal));
            usedLevel3Animals.add(animal);

            const count = Math.floor(Math.random() * 20) + 1;
            const name = animalNames[animal];
            const questionText = count === 1 ? `How many ${name.slice(0, -1)} is there?` : `How many ${name} are there?`;

            document.getElementById('question').innerHTML = questionText;

            const visualDiv = document.getElementById('visual');
            const countDiv = document.createElement('div');
            countDiv.style.fontSize = 'clamp(60px, 15vw, 100px)';
            countDiv.style.lineHeight = '1.6';
            countDiv.style.padding = '20px';
            countDiv.innerHTML = animal.repeat(count);
            visualDiv.appendChild(countDiv);

            let options = [count];
            while (options.length < 4) {
                const rand = Math.floor(Math.random() * 20) + 1;
                if (!options.includes(rand)) options.push(rand);
            }
            options = options.sort(() => Math.random() - 0.5);

            options.forEach(num => {
                const btn = document.createElement('button');
                btn.innerHTML = num;
                btn.onclick = function() { checkAnswer(this, num === count); };
                document.getElementById('options').appendChild(btn);
            });
        }

        function generateLevel4Question() {
            let start, missingIndex;
            do {
                start = Math.floor(Math.random() * 8) + 1;
                missingIndex = 1 + Math.floor(Math.random() * 5);
            } while (usedLevel4Sequences.has(`${start}-${missingIndex}`));
            usedLevel4Sequences.add(`${start}-${missingIndex}`);

            const length = 7;
            const sequence = [];
            let correct = 0;

            for (let i = 0; i < length; i++) {
                if (i === missingIndex) {
                    sequence.push('<span class="missing">?</span>');
                    correct = start + i;
                } else {
                    sequence.push(start + i);
                }
            }

            document.getElementById('question').innerHTML = 'What number should go in place of the red question mark?';
            document.getElementById('visual').innerHTML = `<div class="sequence">${sequence.join(' , ')}</div>`;

            let options = [correct];
            while (options.length < 4) {
                const rand = Math.floor(Math.random() * 20) + 1;
                if (!options.includes(rand)) options.push(rand);
            }
            options = options.sort(() => Math.random() - 0.5);

            options.forEach(num => {
                const btn = document.createElement('button');
                btn.innerHTML = num;
                btn.onclick = function() { checkAnswer(this, num === correct); };
                document.getElementById('options').appendChild(btn);
            });
        }

        function createShapeDiv(shape) {
            const div = document.createElement('div');
            div.className = 'shape';
            const color = shapeColors[Math.floor(Math.random() * shapeColors.length)];
            
            if (shape === 'Circle') {
                div.style.borderRadius = '50%';
                div.style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -40)})`;
            } else if (shape === 'Square') {
                div.style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -40)})`;
            } else if (shape === 'Rectangle') {
                div.style.width = 'calc(1.6 * clamp(80px, 25vw, 140px))';
                div.style.background = `linear-gradient(135deg, ${color}, ${adjustColor(color, -40)})`;
            } else if (shape === 'Triangle') {
                div.style.width = '0';
                div.style.height = '0';
                div.style.background = 'transparent';
                div.style.borderLeft = 'clamp(40px, 12.5vw, 70px) solid transparent';
                div.style.borderRight = 'clamp(40px, 12.5vw, 70px) solid transparent';
                div.style.borderBottom = `clamp(80px, 25vw, 140px) solid ${color}`;
            }
            return div;
        }

        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, c => ('0'+Math.min(255, Math.max(0, parseInt(c,16) + amount)).toString(16)).substr(-2));
        }

        function createEmojiComparison(type) {
            const div = document.createElement('div');
            div.className = 'comparison';

            if (type === 'Thin') div.innerHTML = 'üêà';
            else if (type === 'Fat') div.innerHTML = 'üê∑';
            else if (type === 'Tall') div.innerHTML = 'ü¶í';
            else if (type === 'Short') div.innerHTML = 'üêß';
            else if (type === 'Curve') {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 200 200');
                svg.style.width = '100%';
                svg.style.height = '100%';
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M20 100 Q100 20 180 100');
                path.setAttribute('stroke', '#e74c3c');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke-width', '20');
                path.setAttribute('stroke-linecap', 'round');
                svg.appendChild(path);
                div.appendChild(svg);
            } else if (type === 'Straight') {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 200 200');
                svg.style.width = '100%';
                svg.style.height = '100%';
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', '20'); line.setAttribute('y1', '100');
                line.setAttribute('x2', '180'); line.setAttribute('y2', '100');
                line.setAttribute('stroke', '#2d3436'); line.setAttribute('stroke-width', '20');
                line.setAttribute('stroke-linecap', 'round');
                svg.appendChild(line);
                div.appendChild(svg);
            } else if (type === 'Thick line') {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 200 200');
                svg.style.width = '100%';
                svg.style.height = '100%';
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', '20'); line.setAttribute('y1', '100');
                line.setAttribute('x2', '180'); line.setAttribute('y2', '100');
                line.setAttribute('stroke', '#00b894'); line.setAttribute('stroke-width', '40');
                line.setAttribute('stroke-linecap', 'round');
                svg.appendChild(line);
                div.appendChild(svg);
            } else if (type === 'Thin line') {
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 200 200');
                svg.style.width = '100%';
                svg.style.height = '100%';
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', '20'); line.setAttribute('y1', '100');
                line.setAttribute('x2', '180'); line.setAttribute('y2', '100');
                line.setAttribute('stroke', '#00b894'); line.setAttribute('stroke-width', '10');
                line.setAttribute('stroke-linecap', 'round');
                svg.appendChild(line);
                div.appendChild(svg);
            }

            return div;
        }
    </script>
</body>

</html>

